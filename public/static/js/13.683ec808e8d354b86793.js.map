{"version":3,"sources":["webpack:///src/views/personal/userInfo.vue","webpack:///./src/views/personal/userInfo.vue?21c9","webpack:///./src/views/personal/userInfo.vue"],"names":["userInfo","data","operation","token","operationFuncText","formData","oldData","isUpdata","methods","handleUploadimg","e","_this","this","file","target","files","FormData","append","axios_default","a","post","then","res","avatar","url","getToken","_this2","get","created","mounted","_this3","bus","$emit","$on","val","extends_default","$store","state","userinfo","beforeDestroy","watch","_this4","id","_id","faculty","$axios","put","code","Object","mint_ui_common","commit","beforeRouteLeave","to","from","next","isChangeNum","key","showCancelButton","cancelButtonClass","confirmButtonClass","title","message","action","personal_userInfo","render","_vm","_h","$createElement","_c","_self","staticClass","_v","directives","name","rawName","value","expression","staticStyle","display","attrs","type","on","change","src","alt","disabled","label","model","callback","$$v","$set","grade","_e","class","sex","domProps","checked","_q","$event","_s","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/13.683ec808e8d354b86793.js","sourcesContent":["<template>\r\n    <div class=\"userinfo\">\r\n        <div class=\"itemBox\">\r\n            <span>头像</span>\r\n            <label v-show=\"operation == '保存'\" class=\"uploadAvatar\">\r\n                <input type=\"file\" style=\"display:none\" @change=\"handleUploadimg\">\r\n            </label>\r\n            <img :src=\"formData.avatar\" alt=\"\">\r\n        </div>\r\n        <mt-field class=\"disabled\" disabled label=\"学号/工号\" v-model=\"formData.numId\"></mt-field>\r\n        <mt-field class=\"disabled\" disabled label=\"用户名\" v-model=\"formData.username\"></mt-field>\r\n        <mt-field class=\"disabled\" v-if=\"formData.grade\" disabled label=\"班级\" v-model=\"formData.grade.gradeName\"></mt-field>\r\n        <mt-field class=\"disabled\" v-if=\"formData.faculty\" disabled label=\"院系\" v-model=\"formData.faculty.facultyName\"></mt-field>\r\n        <mt-field :disabled=\"operation == '编辑'\" label=\"简介\" v-model=\"formData.desc\"></mt-field>\r\n        <div class=\"itemBox styleBox sexBox\">\r\n            <span>性别</span>\r\n            <div v-if=\"operation == '保存'\">\r\n                <label :class=\"formData.sex && 'select'\">\r\n                    <i class=\"iconfont icon-tijiaochenggongduigou\"></i>\r\n                    <input type=\"radio\" name=\"sex\" :value=\"1\" v-model=\"formData.sex\">男\r\n                </label>\r\n                <label :class=\"!formData.sex && 'select'\">\r\n                    <i class=\"iconfont icon-tijiaochenggongduigou\"></i>\r\n                    <input type=\"radio\" name=\"sex\" :value=\"0\" v-model=\"formData.sex\">女\r\n                </label>\r\n            </div>\r\n            <span v-else>{{formData.sex ? '男' : '女'}}</span>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport {Toast} from 'mint-ui'\r\nimport bus from '../../bus/index.js'\r\nimport axios from 'axios'\r\nimport {MessageBox} from 'mint-ui'\r\n    export default {\r\n        data() {\r\n            return {\r\n                operation: '编辑',\r\n                token: '',\r\n                operationFuncText : '',\r\n                formData: {},\r\n                oldData: {},\r\n                isUpdata: false\r\n            }\r\n        },\r\n        methods: {\r\n            handleUploadimg(e) {\r\n                let file = e.target.files[0]\r\n                let formData = new FormData()\r\n                formData.append('file',file)\r\n                formData.append('token',this.token)\r\n                axios.post('https://upload-z1.qiniup.com',formData).then(res => {\r\n                    this.formData.avatar = res.data.url\r\n                })\r\n            },\r\n            getToken() {\r\n                axios.get('http://upload.mawenli.xyz').then( res => {\r\n                    this.token = res.data.data\r\n                })\r\n            }\r\n        },\r\n        created() {\r\n            this.getToken()\r\n        },\r\n        mounted() {\r\n            // 头部组件传值\r\n            bus.$emit('status',this.operation)\r\n            bus.$on('operation', val => {\r\n                if (val == '编辑') {\r\n                    this.operationFuncText = '编辑'\r\n                    this.operation = '保存'\r\n                    // console.log('这是编辑状态')\r\n                } else if(val == '保存') {\r\n                    // console.log('这是保存状态')\r\n                    this.operationFuncText = '保存'\r\n                }\r\n                // 这里面不能直接函数，会触发两次 为什么？\r\n            })\r\n\r\n            this.formData = {...this.$store.state.userinfo};\r\n            this.oldData = {...this.$store.state.userinfo};\r\n        },\r\n        // 注销组件时，将状态值至空，不影响其他页面的头部组件\r\n        beforeDestroy() {\r\n            bus.$emit('status','')\r\n        },\r\n        watch: {\r\n            operation (val) {\r\n                bus.$emit('status',this.operation)\r\n            },\r\n            operationFuncText(val){\r\n                if (val == '保存') {\r\n                    // console.log('点击保存按钮,调用保存接口')\r\n                    let url = '';\r\n                    let id = this.$store.state.userinfo._id\r\n                    if (this.$store.state.userinfo.faculty) {\r\n                        // 教师用户\r\n                        url = '/user/teacher';\r\n                    } else {\r\n                        // 学生用户\r\n                        url = '/user/student';\r\n                    }\r\n                    this.$axios.put(`${url}/${id}`, this.formData).then(res => {\r\n                        if (res.code == 0) {\r\n                            Toast('修改成功');\r\n                            this.isUpdata = true;\r\n                            // 赋值vuex\r\n                            this.$store.commit('CHANGEINFO', this.formData);\r\n                        }\r\n                    })\r\n                    // 改变操作按钮\r\n                    this.operation = '编辑'\r\n                }\r\n            }\r\n        },\r\n         // 修改数据后提示用户后再页面跳转\r\n        beforeRouteLeave(to, from, next){\r\n            let isChangeNum = 0\r\n            for (let key in this.oldData) {\r\n                if (this.oldData[key] != this.formData[key]) {\r\n                    isChangeNum ++\r\n                }\r\n            }\r\n            if (isChangeNum && !this.isUpdata){\r\n                // console.log('有数据变化')\r\n                MessageBox({\r\n                    showCancelButton: true,\r\n                    cancelButtonClass: 'ensure',\r\n                    confirmButtonClass: 'cancel',\r\n                    title: '警告',\r\n                    message: '还未保存修改的数据，是否退出？'\r\n                }).then(action => {\r\n                    if (action == 'confirm') {\r\n                        next()\r\n                    }\r\n                })\r\n            } else {\r\n                next()\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped lang='less'>\r\n.userinfo {\r\n    // /deep/ .mint-field-core:disabled {\r\n    //     background: #fff;\r\n    //     color: #6d6e71;\r\n    // }\r\n    /deep/ .mint-field-core {\r\n        // color: #333;\r\n        background: #fff;\r\n    }\r\n    .disabled {\r\n        color: rgb(180, 179, 179);\r\n        /deep/ input {\r\n            color: rgb(180, 179, 179);\r\n        }\r\n    }\r\n    .itemBox {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        height: 48px;\r\n        align-items: center;\r\n        padding: 0 10px;\r\n        background: #fff;\r\n        position: relative;\r\n        .uploadAvatar {\r\n            position: absolute;\r\n            left: 0;\r\n            right: 0;\r\n            height: 0.8rem;\r\n        }\r\n        img {\r\n            width: 0.8rem;\r\n            height: 0.8rem;\r\n        }\r\n    }\r\n    /deep/ .mint-cell-value input{\r\n        text-align: right;\r\n    }\r\n}\r\n.styleBox::before {\r\n    content: '';\r\n    display: block;\r\n    position: absolute;\r\n    top: 0;\r\n    width: 7.1rem;\r\n    height: 1px;\r\n    background: #d7d7d7;\r\n}\r\n.sexBox {\r\n    label {\r\n        color: rgb(107, 107, 107);\r\n        input {\r\n            display: none;\r\n        }\r\n    }\r\n    .select {\r\n        color: #229de4;\r\n    }\r\n}\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/views/personal/userInfo.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"userinfo\"},[_c('div',{staticClass:\"itemBox\"},[_c('span',[_vm._v(\"头像\")]),_vm._v(\" \"),_c('label',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.operation == '保存'),expression:\"operation == '保存'\"}],staticClass:\"uploadAvatar\"},[_c('input',{staticStyle:{\"display\":\"none\"},attrs:{\"type\":\"file\"},on:{\"change\":_vm.handleUploadimg}})]),_vm._v(\" \"),_c('img',{attrs:{\"src\":_vm.formData.avatar,\"alt\":\"\"}})]),_vm._v(\" \"),_c('mt-field',{staticClass:\"disabled\",attrs:{\"disabled\":\"\",\"label\":\"学号/工号\"},model:{value:(_vm.formData.numId),callback:function ($$v) {_vm.$set(_vm.formData, \"numId\", $$v)},expression:\"formData.numId\"}}),_vm._v(\" \"),_c('mt-field',{staticClass:\"disabled\",attrs:{\"disabled\":\"\",\"label\":\"用户名\"},model:{value:(_vm.formData.username),callback:function ($$v) {_vm.$set(_vm.formData, \"username\", $$v)},expression:\"formData.username\"}}),_vm._v(\" \"),(_vm.formData.grade)?_c('mt-field',{staticClass:\"disabled\",attrs:{\"disabled\":\"\",\"label\":\"班级\"},model:{value:(_vm.formData.grade.gradeName),callback:function ($$v) {_vm.$set(_vm.formData.grade, \"gradeName\", $$v)},expression:\"formData.grade.gradeName\"}}):_vm._e(),_vm._v(\" \"),(_vm.formData.faculty)?_c('mt-field',{staticClass:\"disabled\",attrs:{\"disabled\":\"\",\"label\":\"院系\"},model:{value:(_vm.formData.faculty.facultyName),callback:function ($$v) {_vm.$set(_vm.formData.faculty, \"facultyName\", $$v)},expression:\"formData.faculty.facultyName\"}}):_vm._e(),_vm._v(\" \"),_c('mt-field',{attrs:{\"disabled\":_vm.operation == '编辑',\"label\":\"简介\"},model:{value:(_vm.formData.desc),callback:function ($$v) {_vm.$set(_vm.formData, \"desc\", $$v)},expression:\"formData.desc\"}}),_vm._v(\" \"),_c('div',{staticClass:\"itemBox styleBox sexBox\"},[_c('span',[_vm._v(\"性别\")]),_vm._v(\" \"),(_vm.operation == '保存')?_c('div',[_c('label',{class:_vm.formData.sex && 'select'},[_c('i',{staticClass:\"iconfont icon-tijiaochenggongduigou\"}),_vm._v(\" \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.formData.sex),expression:\"formData.sex\"}],attrs:{\"type\":\"radio\",\"name\":\"sex\"},domProps:{\"value\":1,\"checked\":_vm._q(_vm.formData.sex,1)},on:{\"change\":function($event){_vm.$set(_vm.formData, \"sex\", 1)}}}),_vm._v(\"男\\n            \")]),_vm._v(\" \"),_c('label',{class:!_vm.formData.sex && 'select'},[_c('i',{staticClass:\"iconfont icon-tijiaochenggongduigou\"}),_vm._v(\" \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.formData.sex),expression:\"formData.sex\"}],attrs:{\"type\":\"radio\",\"name\":\"sex\"},domProps:{\"value\":0,\"checked\":_vm._q(_vm.formData.sex,0)},on:{\"change\":function($event){_vm.$set(_vm.formData, \"sex\", 0)}}}),_vm._v(\"女\\n            \")])]):_c('span',[_vm._v(_vm._s(_vm.formData.sex ? '男' : '女'))])])],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-033ab91b\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/personal/userInfo.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-033ab91b\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./userInfo.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./userInfo.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./userInfo.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-033ab91b\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./userInfo.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-033ab91b\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/personal/userInfo.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}