webpackJsonp([13],{"9enq":function(a,t){},VIUy:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("Dd8w"),s=e.n(o),n=e("Au9i"),i=e("dV/5"),r=e("mtWM"),l=e.n(r),c={data:function(){return{operation:"编辑",token:"",operationFuncText:"",formData:{},oldData:{},isUpdata:!1}},methods:{handleUploadimg:function(a){var t=this,e=a.target.files[0],o=new FormData;o.append("file",e),o.append("token",this.token),l.a.post("https://upload-z1.qiniup.com",o).then(function(a){t.formData.avatar=a.data.url})},getToken:function(){var a=this;l.a.get("http://upload.mawenli.xyz").then(function(t){a.token=t.data.data})}},created:function(){this.getToken()},mounted:function(){var a=this;i.a.$emit("status",this.operation),i.a.$on("operation",function(t){"编辑"==t?(a.operationFuncText="编辑",a.operation="保存"):"保存"==t&&(a.operationFuncText="保存")}),this.formData=s()({},this.$store.state.userinfo),this.oldData=s()({},this.$store.state.userinfo)},beforeDestroy:function(){i.a.$emit("status","")},watch:{operation:function(a){i.a.$emit("status",this.operation)},operationFuncText:function(a){var t=this;if("保存"==a){var e="",o=this.$store.state.userinfo._id;e=this.$store.state.userinfo.faculty?"/user/teacher":"/user/student",this.$axios.put(e+"/"+o,this.formData).then(function(a){0==a.code&&(Object(n.Toast)("修改成功"),t.isUpdata=!0,t.$store.commit("CHANGEINFO",t.formData))}),this.operation="编辑"}}},beforeRouteLeave:function(a,t,e){var o=0;for(var s in this.oldData)this.oldData[s]!=this.formData[s]&&o++;o&&!this.isUpdata?Object(n.MessageBox)({showCancelButton:!0,cancelButtonClass:"ensure",confirmButtonClass:"cancel",title:"警告",message:"还未保存修改的数据，是否退出？"}).then(function(a){"confirm"==a&&e()}):e()}},d={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"userinfo"},[e("div",{staticClass:"itemBox"},[e("span",[a._v("头像")]),a._v(" "),e("label",{directives:[{name:"show",rawName:"v-show",value:"保存"==a.operation,expression:"operation == '保存'"}],staticClass:"uploadAvatar"},[e("input",{staticStyle:{display:"none"},attrs:{type:"file"},on:{change:a.handleUploadimg}})]),a._v(" "),e("img",{attrs:{src:a.formData.avatar,alt:""}})]),a._v(" "),e("mt-field",{staticClass:"disabled",attrs:{disabled:"",label:"学号/工号"},model:{value:a.formData.numId,callback:function(t){a.$set(a.formData,"numId",t)},expression:"formData.numId"}}),a._v(" "),e("mt-field",{staticClass:"disabled",attrs:{disabled:"",label:"用户名"},model:{value:a.formData.username,callback:function(t){a.$set(a.formData,"username",t)},expression:"formData.username"}}),a._v(" "),a.formData.grade?e("mt-field",{staticClass:"disabled",attrs:{disabled:"",label:"班级"},model:{value:a.formData.grade.gradeName,callback:function(t){a.$set(a.formData.grade,"gradeName",t)},expression:"formData.grade.gradeName"}}):a._e(),a._v(" "),a.formData.faculty?e("mt-field",{staticClass:"disabled",attrs:{disabled:"",label:"院系"},model:{value:a.formData.faculty.facultyName,callback:function(t){a.$set(a.formData.faculty,"facultyName",t)},expression:"formData.faculty.facultyName"}}):a._e(),a._v(" "),e("mt-field",{attrs:{disabled:"编辑"==a.operation,label:"简介"},model:{value:a.formData.desc,callback:function(t){a.$set(a.formData,"desc",t)},expression:"formData.desc"}}),a._v(" "),e("div",{staticClass:"itemBox styleBox sexBox"},[e("span",[a._v("性别")]),a._v(" "),"保存"==a.operation?e("div",[e("label",{class:a.formData.sex&&"select"},[e("i",{staticClass:"iconfont icon-tijiaochenggongduigou"}),a._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:a.formData.sex,expression:"formData.sex"}],attrs:{type:"radio",name:"sex"},domProps:{value:1,checked:a._q(a.formData.sex,1)},on:{change:function(t){a.$set(a.formData,"sex",1)}}}),a._v("男\n            ")]),a._v(" "),e("label",{class:!a.formData.sex&&"select"},[e("i",{staticClass:"iconfont icon-tijiaochenggongduigou"}),a._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:a.formData.sex,expression:"formData.sex"}],attrs:{type:"radio",name:"sex"},domProps:{value:0,checked:a._q(a.formData.sex,0)},on:{change:function(t){a.$set(a.formData,"sex",0)}}}),a._v("女\n            ")])]):e("span",[a._v(a._s(a.formData.sex?"男":"女"))])])],1)},staticRenderFns:[]};var f=e("VU/8")(c,d,!1,function(a){e("9enq")},"data-v-033ab91b",null);t.default=f.exports}});
//# sourceMappingURL=13.683ec808e8d354b86793.js.map